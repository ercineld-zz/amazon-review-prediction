{"paragraphs":[{"text":"%pyspark\n\nfrom pyspark import SparkConf, SparkContext,SQLContext\n\n#conf.set('spark.executor.instances', 5)\nsc = SparkContext.getOrCreate()\nsqlContext = SQLContext(sc)\n\nproductsJsonText = sc.textFile(\"s3a://wer-amazon-review/metadata.json\")\nreviews = sqlContext.read.json(\"s3a://wer-amazon-review/kcore_5.json\")","user":"anonymous","dateUpdated":"2018-04-04T09:36:11+0000","config":{"tableHide":false,"editorSetting":{"language":"python","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1522832431888_-1313578102","id":"20180324-101103_897206083","dateCreated":"2018-04-04T09:00:31+0000","dateStarted":"2018-04-04T09:36:11+0000","dateFinished":"2018-04-04T09:37:07+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3380"},{"text":"%pyspark\nreviewsCountByBooks = reviews.groupby('asin').count().rdd.collectAsMap();","user":"anonymous","dateUpdated":"2018-04-04T09:36:13+0000","config":{"tableHide":false,"editorSetting":{"language":"python","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1522832431888_-1313578102","id":"20180324-111309_642719606","dateCreated":"2018-04-04T09:00:31+0000","dateStarted":"2018-04-04T09:36:13+0000","dateFinished":"2018-04-04T09:37:19+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3381"},{"text":"%pyspark\nimport json,ast;\n\ndef toProductDictinary(productJsonText):\n  productJson =  eval(productJsonText);\n  \n  productDict = {'asin':productJson['asin']}\n  \n  if \"categories\" in productJson:\n    productDict['category'] = productJson['categories'][0][0];\n    if len(productJson['categories'][0]) > 1:\n      print(\"xx\");    \n  else:\n    productDict['category']=\"unknown\";\n  return (productJson[\"asin\"],productDict);\nproductsDictList = productsJsonText.map(lambda x : toProductDictinary(x));\n","user":"anonymous","dateUpdated":"2018-04-04T09:36:16+0000","config":{"tableHide":false,"editorSetting":{"language":"python","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1522832431888_-1313578102","id":"20180310-105307_1881463282","dateCreated":"2018-04-04T09:00:31+0000","dateStarted":"2018-04-04T09:37:08+0000","dateFinished":"2018-04-04T09:37:19+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3382"},{"text":"%pyspark\ndef addReviewCountToProductDictinary(asin ,productDictionary):\n    productDictionary['reviewCount'] = 0;\n    if asin in  reviewsCountByBooks:\n      productDictionary['reviewCount'] = reviewsCountByBooks[asin];\n       \n    return (asin,productDictionary);\n\nproductsDictList = productsDictList.map(lambda x :addReviewCountToProductDictinary(x[0],x[1]));\nprint(productsDictList.take(10))\n","user":"anonymous","dateUpdated":"2018-04-04T09:36:18+0000","config":{"tableHide":false,"editorSetting":{"language":"python","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"[('0001048791', {'category': 'Books', 'asin': '0001048791', 'reviewCount': 0}), ('0000143561', {'category': 'Movies & TV', 'asin': '0000143561', 'reviewCount': 0}), ('0000037214', {'category': 'Clothing, Shoes & Jewelry', 'asin': '0000037214', 'reviewCount': 0}), ('0000032069', {'category': 'Sports & Outdoors', 'asin': '0000032069', 'reviewCount': 0}), ('0000031909', {'category': 'Sports & Outdoors', 'asin': '0000031909', 'reviewCount': 0}), ('0000032034', {'category': 'Sports & Outdoors', 'asin': '0000032034', 'reviewCount': 0}), ('0000589012', {'category': 'Movies & TV', 'asin': '0000589012', 'reviewCount': 8}), ('0001048775', {'category': 'Books', 'asin': '0001048775', 'reviewCount': 0}), ('0000031852', {'category': 'Sports & Outdoors', 'asin': '0000031852', 'reviewCount': 0}), ('0001048236', {'category': 'Books', 'asin': '0001048236', 'reviewCount': 0})]\n"}]},"apps":[],"jobName":"paragraph_1522832431888_-1313578102","id":"20180324-113637_1785073572","dateCreated":"2018-04-04T09:00:31+0000","dateStarted":"2018-04-04T09:37:19+0000","dateFinished":"2018-04-04T09:37:31+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3383"},{"text":"%pyspark\n   \nproductReviewCountDict= sc.broadcast(reviewsCountByBooks);\n","user":"anonymous","dateUpdated":"2018-04-04T09:36:22+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1522832431888_-1313578102","id":"20180325-203919_1226936079","dateCreated":"2018-04-04T09:00:31+0000","dateStarted":"2018-04-04T09:37:20+0000","dateFinished":"2018-04-04T09:37:31+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3384"},{"text":"%pyspark\nfrom pyspark.sql.functions import length,udf,col;\nfrom pyspark.sql.types import StringType,FloatType,LongType \n\ndef getProductCategory(asin):\n    return \"unknown\"   \n    \ndef getProductReviewCounty(asin):\n    if asin in  productReviewCountDict.value:\n      return int(productReviewCountDict.value[asin]);\n    return 0;     \n\ngetProductCategory_udf = udf(getProductCategory, StringType())\ngetProductReviewCounty_udf = udf(getProductReviewCounty, StringType())\n\nreviews = reviews.withColumn('reviewLength', length('reviewText'))\nreviews = reviews.withColumn('summaryLength', length('summary'))\nreviews = reviews.withColumn('category' ,getProductCategory_udf(col('asin')))\nreviews = reviews.withColumn('reviewCount' ,getProductReviewCounty_udf(col('asin')))\nreviews = reviews.withColumn(\"reviewCount\", col(\"reviewCount\").cast(\"int\"))\nreviews.show()","user":"anonymous","dateUpdated":"2018-04-04T09:36:24+0000","config":{"tableHide":false,"editorSetting":{"language":"python","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/python","results":{"0":{"graph":{"mode":"table","height":314,"optionOpen":false}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----------+-------+-------+--------------------+-----------+--------------+--------------------+--------------------+--------------+------------+-------------+--------+-----------+\n|      asin|helpful|overall|          reviewText| reviewTime|    reviewerID|        reviewerName|             summary|unixReviewTime|reviewLength|summaryLength|category|reviewCount|\n+----------+-------+-------+--------------------+-----------+--------------+--------------------+--------------------+--------------+------------+-------------+--------+-----------+\n|0000013714| [0, 0]|    4.0|We use this type ...| 12 3, 2013| ACNGUPJ3A3TM9|                 GCM|         Nice Hymnal|    1386028800|         179|           11| unknown|          5|\n|0000013714| [2, 3]|    5.0|I bought this for...|09 13, 2009|A2SUAM1J3GNN3B|         J. McDonald|Heavenly Highway ...|    1252800000|         247|           22| unknown|          5|\n|0000013714| [0, 0]|    5.0|This is a large s...| 03 9, 2013| APOZ15IEYQRRR|           maewest64|   Awesome Hymn Book|    1362787200|         120|           17| unknown|          5|\n|0000013714| [0, 0]|    5.0|We use this hymn ...| 01 2, 2012| AYEDW3BFK53XK|               Missb|Hand Clapping Toe...|    1325462400|         248|           32| unknown|          5|\n|0000013714| [0, 0]|    3.0|One review advise...|08 10, 2013|A1KLCGLCXYP1U1| Paul L \"Paul Lytle\"|          Misleading|    1376092800|         161|           10| unknown|          5|\n|0000029831| [3, 3]|    4.0|This work bears d...|02 25, 2014|A14A5Q8VJK5NLR|               Auros|Logical follow-up...|    1393286400|         474|           38| unknown|          5|\n|0000029831| [4, 4]|    5.0|You may laugh, bu...|02 24, 2014|A3W2PX96K1BA3M|Flav Josephus \"On...|The superior clea...|    1393200000|        1326|           21| unknown|          5|\n|0000029831| [3, 3]|    5.0|Do not try and va...|02 25, 2014|A2GKR2Q7MD8DG4|        Jill Randall|Very deep and tho...|    1393286400|         186|           32| unknown|          5|\n|0000029831| [3, 3]|    5.0|What if Dread had...|02 24, 2014|A1MC4E00RO5E9T|        Johan Klovsj|        WHAT IF....?|    1393200000|         362|           12| unknown|          5|\n|0000029831| [5, 5]|    5.0|I thought this bo...|02 24, 2014|A23PISU0ZLW71C|               Ron H|              Review|    1393200000|         535|            6| unknown|          5|\n|0000031887| [1, 1]|    4.0|This was a really...|05 26, 2012|A2G0LNLN79Q6HR|       aj_18 \"Aj_18\"|Really Cute but r...|    1337990400|         136|           29| unknown|        149|\n|0000031887| [1, 1]|    2.0|the tutu color wa...|02 17, 2013|A2R3K1KX09QBYP|      alert consumer|not very good mat...|    1361059200|         236|           23| unknown|        149|\n|0000031887| [0, 0]|    4.0|Bought it for my ...|01 23, 2014|A1P0IHU93EF9ZK|              Amanda|           i love it|    1390435200|         143|            9| unknown|        149|\n|0000031887| [0, 0]|    5.0|This is a great t...|02 12, 2011|A1KLRMWW2FWPL4|Amazon Customer \"...|Great tutu-  not ...|    1297468800|         172|           29| unknown|        149|\n|0000031887| [0, 0]|    5.0|Got this for our ...|12 26, 2012|A1GQPAM8Y45QN7|     Amazon Customer|                Tutu|    1356480000|         109|            4| unknown|        149|\n|0000031887| [0, 0]|    5.0|I bought this for...|01 19, 2013|A2G5TCU2WDFZ65|     Amazon Customer|         Very Cute!!|    1358553600|         306|           11| unknown|        149|\n|0000031887| [0, 0]|    5.0|Just as described...|06 22, 2013| AEAN37KUOYSX4|     Amazon Customer|          Fantastic!|    1371859200|         236|           10| unknown|        149|\n|0000031887| [0, 0]|    5.0|Purchased it for ...|06 16, 2014|A1MCJONUQ78L9T|     Amazon Customer|My daughter loved...|    1402876800|         135|           21| unknown|        149|\n|0000031887| [0, 0]|    4.0|Very cute, shorte...|12 10, 2013|A2PSIVW9I3TGHD|     Amazon Customer|        Good product|    1386633600|         462|           12| unknown|        149|\n|0000031887| [0, 0]|    5.0|Vey cute and perf...|02 18, 2014|A3CHBY0CB0O7PP|     Amazon Customer|                cute|    1392681600|         101|            4| unknown|        149|\n+----------+-------+-------+--------------------+-----------+--------------+--------------------+--------------------+--------------+------------+-------------+--------+-----------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1522832431888_-1313578102","id":"20180324-132224_237810181","dateCreated":"2018-04-04T09:00:31+0000","dateStarted":"2018-04-04T09:37:31+0000","dateFinished":"2018-04-04T09:37:33+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3385"},{"text":"%pyspark\nreviews = reviews.withColumn(\"total_votes\",reviews[\"helpful\"].getItem(1)).withColumn(\"helpful\", reviews[\"helpful\"].getItem(0))\nreviews.show()\n\n","user":"anonymous","dateUpdated":"2018-04-04T09:36:29+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----------+-------+-------+--------------------+-----------+--------------+--------------------+--------------------+--------------+------------+-------------+--------+-----------+-----------+\n|      asin|helpful|overall|          reviewText| reviewTime|    reviewerID|        reviewerName|             summary|unixReviewTime|reviewLength|summaryLength|category|reviewCount|total_votes|\n+----------+-------+-------+--------------------+-----------+--------------+--------------------+--------------------+--------------+------------+-------------+--------+-----------+-----------+\n|0000013714|      0|    4.0|We use this type ...| 12 3, 2013| ACNGUPJ3A3TM9|                 GCM|         Nice Hymnal|    1386028800|         179|           11| unknown|          5|          0|\n|0000013714|      2|    5.0|I bought this for...|09 13, 2009|A2SUAM1J3GNN3B|         J. McDonald|Heavenly Highway ...|    1252800000|         247|           22| unknown|          5|          3|\n|0000013714|      0|    5.0|This is a large s...| 03 9, 2013| APOZ15IEYQRRR|           maewest64|   Awesome Hymn Book|    1362787200|         120|           17| unknown|          5|          0|\n|0000013714|      0|    5.0|We use this hymn ...| 01 2, 2012| AYEDW3BFK53XK|               Missb|Hand Clapping Toe...|    1325462400|         248|           32| unknown|          5|          0|\n|0000013714|      0|    3.0|One review advise...|08 10, 2013|A1KLCGLCXYP1U1| Paul L \"Paul Lytle\"|          Misleading|    1376092800|         161|           10| unknown|          5|          0|\n|0000029831|      3|    4.0|This work bears d...|02 25, 2014|A14A5Q8VJK5NLR|               Auros|Logical follow-up...|    1393286400|         474|           38| unknown|          5|          3|\n|0000029831|      4|    5.0|You may laugh, bu...|02 24, 2014|A3W2PX96K1BA3M|Flav Josephus \"On...|The superior clea...|    1393200000|        1326|           21| unknown|          5|          4|\n|0000029831|      3|    5.0|Do not try and va...|02 25, 2014|A2GKR2Q7MD8DG4|        Jill Randall|Very deep and tho...|    1393286400|         186|           32| unknown|          5|          3|\n|0000029831|      3|    5.0|What if Dread had...|02 24, 2014|A1MC4E00RO5E9T|        Johan Klovsj|        WHAT IF....?|    1393200000|         362|           12| unknown|          5|          3|\n|0000029831|      5|    5.0|I thought this bo...|02 24, 2014|A23PISU0ZLW71C|               Ron H|              Review|    1393200000|         535|            6| unknown|          5|          5|\n|0000031887|      1|    4.0|This was a really...|05 26, 2012|A2G0LNLN79Q6HR|       aj_18 \"Aj_18\"|Really Cute but r...|    1337990400|         136|           29| unknown|        149|          1|\n|0000031887|      1|    2.0|the tutu color wa...|02 17, 2013|A2R3K1KX09QBYP|      alert consumer|not very good mat...|    1361059200|         236|           23| unknown|        149|          1|\n|0000031887|      0|    4.0|Bought it for my ...|01 23, 2014|A1P0IHU93EF9ZK|              Amanda|           i love it|    1390435200|         143|            9| unknown|        149|          0|\n|0000031887|      0|    5.0|This is a great t...|02 12, 2011|A1KLRMWW2FWPL4|Amazon Customer \"...|Great tutu-  not ...|    1297468800|         172|           29| unknown|        149|          0|\n|0000031887|      0|    5.0|Got this for our ...|12 26, 2012|A1GQPAM8Y45QN7|     Amazon Customer|                Tutu|    1356480000|         109|            4| unknown|        149|          0|\n|0000031887|      0|    5.0|I bought this for...|01 19, 2013|A2G5TCU2WDFZ65|     Amazon Customer|         Very Cute!!|    1358553600|         306|           11| unknown|        149|          0|\n|0000031887|      0|    5.0|Just as described...|06 22, 2013| AEAN37KUOYSX4|     Amazon Customer|          Fantastic!|    1371859200|         236|           10| unknown|        149|          0|\n|0000031887|      0|    5.0|Purchased it for ...|06 16, 2014|A1MCJONUQ78L9T|     Amazon Customer|My daughter loved...|    1402876800|         135|           21| unknown|        149|          0|\n|0000031887|      0|    4.0|Very cute, shorte...|12 10, 2013|A2PSIVW9I3TGHD|     Amazon Customer|        Good product|    1386633600|         462|           12| unknown|        149|          0|\n|0000031887|      0|    5.0|Vey cute and perf...|02 18, 2014|A3CHBY0CB0O7PP|     Amazon Customer|                cute|    1392681600|         101|            4| unknown|        149|          0|\n+----------+-------+-------+--------------------+-----------+--------------+--------------------+--------------------+--------------+------------+-------------+--------+-----------+-----------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1522832431889_-1313962851","id":"20180331-141947_938770358","dateCreated":"2018-04-04T09:00:31+0000","dateStarted":"2018-04-04T09:37:32+0000","dateFinished":"2018-04-04T09:37:34+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3386"},{"text":"%pyspark\nreviews.createOrReplaceTempView(\"reviews2\")\nreviewdf = sqlContext.sql(\"SELECT CASE WHEN helpful/total_votes> 0.6 THEN 1 ELSE 0 END AS Helpful_Score, reviewText, reviewLength, summaryLength,category,reviewCount, overall FROM reviews2\")\nreviewdf.show(5)","user":"anonymous","dateUpdated":"2018-04-04T09:36:31+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------------+--------------------+------------+-------------+--------+-----------+-------+\n|Helpful_Score|          reviewText|reviewLength|summaryLength|category|reviewCount|overall|\n+-------------+--------------------+------------+-------------+--------+-----------+-------+\n|            0|We use this type ...|         179|           11| unknown|          5|    4.0|\n|            1|I bought this for...|         247|           22| unknown|          5|    5.0|\n|            0|This is a large s...|         120|           17| unknown|          5|    5.0|\n|            0|We use this hymn ...|         248|           32| unknown|          5|    5.0|\n|            0|One review advise...|         161|           10| unknown|          5|    3.0|\n+-------------+--------------------+------------+-------------+--------+-----------+-------+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1522832431889_-1313962851","id":"20180331-142107_480371176","dateCreated":"2018-04-04T09:00:31+0000","dateStarted":"2018-04-04T09:37:34+0000","dateFinished":"2018-04-04T09:37:36+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3387"},{"text":"%pyspark\nimport pyspark.sql.functions as func\nfrom pyspark.ml.feature import HashingTF, IDF, Tokenizer\nfrom pyspark.ml.feature import StopWordsRemover\n\ntokenizer = Tokenizer(inputCol=\"reviewText\", outputCol=\"words\")\nwordsData = tokenizer.transform(reviewdf)\n\n#StopWords Exclution\nremover = StopWordsRemover(inputCol=\"words\", outputCol=\"filtered\")\nwordsData = remover.transform(wordsData)\nwordsData = wordsData.select('filtered', 'summaryLength', 'reviewLength','Helpful_Score','overall','reviewCount')\nwordsData.show(5)","user":"anonymous","dateUpdated":"2018-04-04T09:36:33+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+-------------+------------+-------------+-------+-----------+\n|            filtered|summaryLength|reviewLength|Helpful_Score|overall|reviewCount|\n+--------------------+-------------+------------+-------------+-------+-----------+\n|[use, type, hymna...|           11|         179|            0|    4.0|          5|\n|[bought, husband,...|           22|         247|            1|    5.0|          5|\n|[large, size, hym...|           17|         120|            0|    5.0|          5|\n|[use, hymn, book,...|           32|         248|            0|    5.0|          5|\n|[one, review, adv...|           10|         161|            0|    3.0|          5|\n+--------------------+-------------+------------+-------------+-------+-----------+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1522832431889_-1313962851","id":"20180314-145223_442903515","dateCreated":"2018-04-04T09:00:31+0000","dateStarted":"2018-04-04T09:37:35+0000","dateFinished":"2018-04-04T09:37:37+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3388"},{"text":"%pyspark\n#Hash TF on tokenized data\nhashingTF = HashingTF(inputCol=\"filtered\", outputCol=\"rawFeatures\", numFeatures=50)\nfeaturizedData = hashingTF.transform(wordsData)\n\n#TF-IDF Vectorizer\nidf = IDF(inputCol=\"rawFeatures\", outputCol=\"features\")\nidfModel = idf.fit(featurizedData)\nrescaledData = idfModel.transform(featurizedData)\n\ndata = rescaledData.select(\"features\",\"summaryLength\", \"reviewLength\",\"reviewCount\", \"overall\",\"Helpful_Score\")\ndata.show(5)\ntype(data)\n\ndata.createOrReplaceTempView(\"data2\")\ndata = sqlContext.sql(\"SELECT features as tfidfvector, summaryLength, reviewLength,reviewCount, overall, Helpful_Score as label FROM data2\")\ndata.show(5)\ntype(data)\n","user":"anonymous","dateUpdated":"2018-04-04T09:36:35+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+-------------+------------+-----------+-------+-------------+\n|            features|summaryLength|reviewLength|reviewCount|overall|Helpful_Score|\n+--------------------+-------------+------------+-----------+-------+-------------+\n|(50,[10,12,15,18,...|           11|         179|          5|    4.0|            0|\n|(50,[0,2,3,4,7,10...|           22|         247|          5|    5.0|            1|\n|(50,[7,10,11,15,1...|           17|         120|          5|    5.0|            0|\n|(50,[0,3,4,7,10,1...|           32|         248|          5|    5.0|            0|\n|(50,[2,12,16,18,2...|           10|         161|          5|    3.0|            0|\n+--------------------+-------------+------------+-----------+-------+-------------+\nonly showing top 5 rows\n\n+--------------------+-------------+------------+-----------+-------+-----+\n|         tfidfvector|summaryLength|reviewLength|reviewCount|overall|label|\n+--------------------+-------------+------------+-----------+-------+-----+\n|(50,[10,12,15,18,...|           11|         179|          5|    4.0|    0|\n|(50,[0,2,3,4,7,10...|           22|         247|          5|    5.0|    1|\n|(50,[7,10,11,15,1...|           17|         120|          5|    5.0|    0|\n|(50,[0,3,4,7,10,1...|           32|         248|          5|    5.0|    0|\n|(50,[2,12,16,18,2...|           10|         161|          5|    3.0|    0|\n+--------------------+-------------+------------+-----------+-------+-----+\nonly showing top 5 rows\n\n<class 'pyspark.sql.dataframe.DataFrame'>\n"}]},"apps":[],"jobName":"paragraph_1522832431889_-1313962851","id":"20180331-114917_941724864","dateCreated":"2018-04-04T09:00:31+0000","dateStarted":"2018-04-04T09:37:36+0000","dateFinished":"2018-04-04T09:42:26+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3389"},{"text":"%pyspark\nfrom pyspark.ml.linalg import Vectors\nfrom pyspark.ml.feature import VectorAssembler\n\n#Combining features as one features column\nassembler = VectorAssembler(inputCols=[\"tfidfvector\",\"summaryLength\",\"reviewLength\",\"reviewCount\", \"overall\"], outputCol=\"features\")\noutput = assembler.transform(data)\nfinaldf = output.select(\"features\", \"label\")\nfinaldf.show(5)","user":"anonymous","dateUpdated":"2018-04-04T09:36:37+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+-----+\n|            features|label|\n+--------------------+-----+\n|(54,[10,12,15,18,...|    0|\n|(54,[0,2,3,4,7,10...|    1|\n|(54,[7,10,11,15,1...|    0|\n|(54,[0,3,4,7,10,1...|    0|\n|(54,[2,12,16,18,2...|    0|\n+--------------------+-----+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1522832431889_-1313962851","id":"20180331-143542_297516380","dateCreated":"2018-04-04T09:00:31+0000","dateStarted":"2018-04-04T09:37:38+0000","dateFinished":"2018-04-04T09:42:28+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3390"},{"text":"%pyspark\n\n#Split the data into training and test sets (30% held out for testing)\ntrain, test = finaldf.randomSplit([0.7, 0.3], seed=12345)\ntrain.show(5)\ntest.show(5)\n","user":"anonymous","dateUpdated":"2018-04-04T09:36:39+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+-----+\n|            features|label|\n+--------------------+-----+\n|(54,[0,1,2,3,4,5,...|    1|\n|(54,[0,1,2,3,4,5,...|    0|\n|(54,[0,1,2,3,4,5,...|    0|\n|(54,[0,1,2,3,4,5,...|    0|\n|(54,[0,1,2,3,4,5,...|    0|\n+--------------------+-----+\nonly showing top 5 rows\n\n+--------------------+-----+\n|            features|label|\n+--------------------+-----+\n|(54,[0,1,2,3,4,5,...|    0|\n|(54,[0,1,2,3,4,5,...|    0|\n|(54,[0,1,2,3,4,5,...|    0|\n|(54,[0,1,2,3,4,5,...|    1|\n|(54,[0,1,2,3,4,5,...|    0|\n+--------------------+-----+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1522832431889_-1313962851","id":"20180331-144319_882835284","dateCreated":"2018-04-04T09:00:31+0000","dateStarted":"2018-04-04T09:42:26+0000","dateFinished":"2018-04-04T09:43:00+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3391"},{"text":"%pyspark\nfrom pyspark.ml import Pipeline\nfrom pyspark.ml.classification import RandomForestClassifier\nfrom pyspark.ml.feature import IndexToString, StringIndexer, VectorIndexer\nfrom pyspark.ml.evaluation import MulticlassClassificationEvaluator\n\nlabelIndexer = StringIndexer(inputCol=\"label\", outputCol=\"indexedLabel\").fit(finaldf)\n\nfeatureIndexer = VectorIndexer(inputCol=\"features\", outputCol=\"indexedFeatures\", maxCategories=4).fit(finaldf)\n\n# Train a RandomForest model.\nrf = RandomForestClassifier(labelCol=\"indexedLabel\", featuresCol=\"indexedFeatures\", numTrees=20)\n\nlabelConverter = IndexToString(inputCol=\"prediction\", outputCol=\"predictedLabel\", labels=labelIndexer.labels)\n                               \n# Chain indexers and forest in a Pipeline\npipeline = Pipeline(stages=[labelIndexer, featureIndexer, rf, labelConverter])\n\n# Train model.  This also runs the indexers.\nmodel = pipeline.fit(train)\n\n# Make predictions.\npredictions = model.transform(test)\n\n# Select example rows to display.\npredictions.select(\"predictedLabel\", \"label\", \"features\").show(5)\n\n# Select (prediction, true label) and compute test error\nevaluator = MulticlassClassificationEvaluator(labelCol=\"indexedLabel\", predictionCol=\"prediction\", metricName=\"accuracy\")\n\naccuracy = evaluator.evaluate(predictions)\n\nprint(\"Test Error = %g\" % (1.0 - accuracy))\n\nrfModel = model.stages[2]\n\nprint(rfModel)  # summary only","user":"anonymous","dateUpdated":"2018-04-04T09:36:41+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1522832431889_-1313962851","id":"20180331-144448_697162431","dateCreated":"2018-04-04T09:00:31+0000","dateStarted":"2018-04-04T09:42:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3392","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------+-----+--------------------+\n|predictedLabel|label|            features|\n+--------------+-----+--------------------+\n|             0|    0|(54,[0,1,2,3,4,5,...|\n|             0|    0|(54,[0,1,2,3,4,5,...|\n|             0|    0|(54,[0,1,2,3,4,5,...|\n|             0|    1|(54,[0,1,2,3,4,5,...|\n|             0|    0|(54,[0,1,2,3,4,5,...|\n+--------------+-----+--------------------+\nonly showing top 5 rows\n\nTest Error = 0.291337\nRandomForestClassificationModel (uid=RandomForestClassifier_40f0acee6fedcdcf0448) with 20 trees\n"}]},"dateFinished":"2018-04-04T10:17:01+0000"},{"text":"%pyspark\nfrom pyspark.ml import Pipeline\nfrom pyspark.ml.classification import GBTClassifier\nfrom pyspark.ml.feature import StringIndexer, VectorIndexer\nfrom pyspark.ml.evaluation import MulticlassClassificationEvaluator\n\n\nlabelIndexer = StringIndexer(inputCol=\"label\", outputCol=\"indexedLabel\").fit(finaldf)\n\nfeatureIndexer =\\\n    VectorIndexer(inputCol=\"features\", outputCol=\"indexedFeatures\", maxCategories=4).fit(finaldf)\n    \n#Split the data into training and test sets (30% held out for testing)\n#train, test = finaldf.randomSplit([0.7, 0.3], seed=12345)\n\n# Train a GBT model.\ngbt = GBTClassifier(labelCol=\"indexedLabel\", featuresCol=\"indexedFeatures\", maxIter=20)\n\n# Chain indexers and GBT in a Pipeline\npipeline = Pipeline(stages=[labelIndexer, featureIndexer, gbt])\n\n# Train model.  This also runs the indexers.\nmodel = pipeline.fit(train)\n\n# Make predictions.\npredictions = model.transform(test)\n\n# Select example rows to display.\npredictions.select(\"prediction\", \"indexedLabel\", \"features\").show(5)\n\n# Select (prediction, true label) and compute test error\nevaluator = MulticlassClassificationEvaluator(\n    labelCol=\"indexedLabel\", predictionCol=\"prediction\", metricName=\"accuracy\")\naccuracy = evaluator.evaluate(predictions)\nprint(\"Test Error = %g\" % (1.0 - accuracy))\n\n\ngbtModel = model.stages[2]\nprint(gbtModel)  # summary only","user":"anonymous","dateUpdated":"2018-04-04T09:36:45+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1522832431889_-1313962851","id":"20180331-144738_1536936614","dateCreated":"2018-04-04T09:00:31+0000","dateStarted":"2018-04-04T09:43:01+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3393","dateFinished":"2018-04-04T10:47:49+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----------+------------+--------------------+\n|prediction|indexedLabel|            features|\n+----------+------------+--------------------+\n|       0.0|         0.0|(54,[0,1,2,3,4,5,...|\n|       0.0|         0.0|(54,[0,1,2,3,4,5,...|\n|       0.0|         0.0|(54,[0,1,2,3,4,5,...|\n|       0.0|         1.0|(54,[0,1,2,3,4,5,...|\n|       0.0|         0.0|(54,[0,1,2,3,4,5,...|\n+----------+------------+--------------------+\nonly showing top 5 rows\n\nTest Error = 0.284403\nGBTClassificationModel (uid=GBTClassifier_4333b2000d1ba40b7da3) with 20 trees\n"}]}},{"text":"%pyspark\nfrom pyspark.ml.classification import NaiveBayes\nfrom pyspark.ml.evaluation import MulticlassClassificationEvaluator\n\n#Split the data into training and test sets (30% held out for testing)\n#train, test = finaldf.randomSplit([0.7, 0.3], seed=12345)\n\n# create the trainer and set its parameters\nnb = NaiveBayes(smoothing=1.0, modelType=\"multinomial\")\n\n# train the model\nmodel = nb.fit(train)\n\n# select example rows to display.\npredictions = model.transform(test)\npredictions.show()\n\n# compute accuracy on the test set\nevaluator = MulticlassClassificationEvaluator(labelCol=\"label\", predictionCol=\"prediction\",\n                                              metricName=\"accuracy\")\naccuracy = evaluator.evaluate(predictions)\nprint(\"Test set accuracy = \" + str(accuracy))\n","user":"anonymous","dateUpdated":"2018-04-04T09:36:49+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+-----+--------------------+--------------------+----------+\n|            features|label|       rawPrediction|         probability|prediction|\n+--------------------+-----+--------------------+--------------------+----------+\n|(54,[0,1,2,3,4,5,...|    0|[-1176.3127300209...|[1.59341924713139...|       1.0|\n|(54,[0,1,2,3,4,5,...|    0|[-1047.3346981779...|[1.0,1.1740355358...|       0.0|\n|(54,[0,1,2,3,4,5,...|    0|[-1003.6725243038...|[1.0,1.4847673315...|       0.0|\n|(54,[0,1,2,3,4,5,...|    1|[-1120.7253815919...|[1.0,3.5184627887...|       0.0|\n|(54,[0,1,2,3,4,5,...|    0|[-1093.3147188896...|[1.0,6.8176937761...|       0.0|\n|(54,[0,1,2,3,4,5,...|    0|[-818.41000764115...|[5.24059574176821...|       1.0|\n|(54,[0,1,2,3,4,5,...|    1|[-537.78173371275...|[2.25490523673472...|       1.0|\n|(54,[0,1,2,3,4,5,...|    1|[-5104.1433531045...|           [1.0,0.0]|       0.0|\n|(54,[0,1,2,3,4,5,...|    0|[-881.36768492341...|[2.51267751587836...|       1.0|\n|(54,[0,1,2,3,4,5,...|    1|[-862.68423468438...|[8.08352753257121...|       1.0|\n|(54,[0,1,2,3,4,5,...|    1|[-897.48043858646...|[1.0,6.0084005233...|       0.0|\n|(54,[0,1,2,3,4,5,...|    0|[-2287.7046826226...|           [1.0,0.0]|       0.0|\n|(54,[0,1,2,3,4,5,...|    0|[-719.04679380737...|[2.43741370730756...|       1.0|\n|(54,[0,1,2,3,4,5,...|    1|[-833.86987160666...|[1.08332733248393...|       1.0|\n|(54,[0,1,2,3,4,5,...|    0|[-799.57216456634...|[1.74359042283961...|       1.0|\n|(54,[0,1,2,3,4,5,...|    0|[-3244.2339130040...|           [1.0,0.0]|       0.0|\n|(54,[0,1,2,3,4,5,...|    0|[-315.79849739168...|[1.67916505511162...|       1.0|\n|(54,[0,1,2,3,4,5,...|    1|[-861.49927105519...|[6.13087534255172...|       1.0|\n|(54,[0,1,2,3,4,5,...|    1|[-835.54080087892...|[1.62287793003043...|       1.0|\n|(54,[0,1,2,3,4,5,...|    1|[-588.67917052126...|[2.18603510534360...|       1.0|\n+--------------------+-----+--------------------+--------------------+----------+\nonly showing top 20 rows\n\nTest set accuracy = 0.527796096878\n"}]},"apps":[],"jobName":"paragraph_1522832431889_-1313962851","id":"20180331-150046_57400674","dateCreated":"2018-04-04T09:00:31+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3394","dateFinished":"2018-04-04T11:04:27+0000","dateStarted":"2018-04-04T10:17:02+0000"},{"text":"%pyspark\nsc.stop()\n","dateUpdated":"2018-04-04T10:09:53+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1522832431890_-1312808604","id":"20180331-150625_784995038","dateCreated":"2018-04-04T09:00:31+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3395","user":"anonymous","dateFinished":"2018-04-04T11:04:28+0000","dateStarted":"2018-04-04T10:47:49+0000"},{"text":"%pyspark\n","dateUpdated":"2018-04-04T09:00:31+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1522832431890_-1312808604","id":"20180401-114647_2129504073","dateCreated":"2018-04-04T09:00:31+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:3396"}],"name":"wer-yunus","id":"2DCDKAPN7","angularObjects":{"2BRWU4WXC:shared_process":[],"2AM1YV5CU:shared_process":[],"2AJXGMUUJ:shared_process":[],"2ANGGHHMQ:shared_process":[],"2AKK3QQXU:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}
